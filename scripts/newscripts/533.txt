#include"mapping.h"

int iteration=0;
int mapid=STARTMAP;
int mapy=STARTMAP;
void main()
{

	for(int mapx=STARTMAP;mapx<STARTMAP+NUMMAPS;mapx++)
	{
		cMap *map=mapStruct(mapid);
		clear(mapid);
		for(int x=0;x<20;x++)
		{
			for(int y=0;y<15;y++)
			{
				if((mapx==STARTMAP&&x<WATER_BORDER)||(mapx==STARTMAP+NUMMAPS-1&&x>20-WATER_BORDER)||(mapy==STARTMAP&&y<WATER_BORDER)||(mapy==STARTMAP+NUMMAPS-1&&y>15-WATER_BORDER))
				{
					map->map[y][x].tile[0]=WATER_TILE;
					map->map[y][x].type=TILE_TYPE_WALL;
				}
				else if(!iteration)
				{
					map->map[y][x].tile[0]=GRASS_TILE;
					map->map[y][x].type=TILE_TYPE_NONE;
				}
				else
				{
					map->map[y][x].tile[0]=DIRT_TILE;
					map->map[y][x].type=TILE_TYPE_WALL;
				}
				
				if(iteration)
				{
					map->map[y][x].tile[3]=SHADOW_TILE;
				}
			}
		}
		if(!iteration)
		{
			sprintf(map->name,"New Mystera %d %d",mapx - STARTMAP,mapy - STARTMAP);
			map->npc[4].index=40;
		}
		else
		{
			sprintf(map->name,"The Underground %d %d",mapx - STARTMAP,mapy - STARTMAP);
			map->npc[4].index=25;
			map->npc[4].qty=-60;
		}
		
		if(mapy!=STARTMAP)
		{
			map->n=mapid-NUMMAPS;
		}
		else
		{
			map->n=mapid;
		}
		
		if(mapy<STARTMAP + NUMMAPS - 1)
		{
			map->s=mapid+NUMMAPS;
		}
		else
		{
			map->s=mapid;
		}
		
		if(mapx!=STARTMAP)
		{
			map->w=mapid-1;
		}
		else
		{
			map->w=mapid;
		}
		
		if(mapx<STARTMAP + NUMMAPS - 1)
		{
			map->e=mapid+1;
		}
		else
		{
			map->e=mapid;
		}
		savemap(mapid);
		mapid++;
	}
	
	if(mapy<NUMMAPS + STARTMAP - 1)
	{
		mapy++;
		runScript(myScript(),50);
	}
	else if(iteration==0)
	{
		mapy=NUMMAPS;
		iteration=1;
		runScript(myScript(),3000);
	}
	else
	{
		mapy=STARTMAP;
		iteration=0;
		mapid=0;
		runScript(534,1000);
	}
}
/*
******
******
******
******
******
******
*/